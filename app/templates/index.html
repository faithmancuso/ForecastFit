<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForecastFit - Local Weather</title>

    <!-- External Styles and Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="home_page" 
    style="background-image: url('/static/background.jpg'); background-size: cover; background-position: center; background-attachment: fixed; height: 100vh;">
    
    <!-- Header -->
    <header class="translucent">
        <h1>ForecastFit <i class="fas fa-cloud-sun"></i></h1>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Weather Section -->
        <section id="weather-section" class="translucent">
            <!-- Unit Selection -->
            <div id="unit-selection">
                <label><input type="radio" name="tempUnit" value="F" checked> Fahrenheit</label>
                <label><input type="radio" name="tempUnit" value="C"> Celsius</label>
            </div>

            <!-- Weather Options -->
            <div id="weather-options">
                <label for="zip-code-input"><i class="fas fa-map-marker-alt"></i> Enter your Zip Code for local weather:</label>
                <input type="text" id="zip-code-input" placeholder="44113" required>
                <button onclick="fetchWeather()"><i class="fas fa-check"></i> Submit</button>

                <div id="forecast-buttons">
                    <button onclick="showToday()"><i class="fas fa-calendar-day"></i> Today (Hourly)</button>
                    <button onclick="show3Day()"><i class="fas fa-calendar-week"></i> 3-Day Forecast</button>
                </div>
            </div>

            <!-- Weather Results -->
            <div id="today-weather" class="weather-container" style="display: none;">
                <h2>Today's Weather (Hourly) <i class="fas fa-clock"></i></h2>
                <div id="hourly-forecast"></div>
            </div>

            <div id="forecast-3-days" class="weather-container" style="display: none;">
                <h2>3-Day Forecast <i class="fas fa-calendar"></i></h2>
                <div id="daily-forecast"></div>
            </div>
        </section>

        <!-- Right-side Widgets -->
        <section id="right-widgets" class="translucent">
            <!-- Subscribe Form -->
            <div id="form-container" class="translucent">
                <div id="subscribe-notification" style="display: none; color: green; font-weight: bold; margin-bottom: 10px;">
                    Success! You have subscribed.
                </div>
                <h3><i class="fas fa-map-marker-alt"></i> Enter your Zip Code:</h3>
                <input type="text" id="subscribe-zip" placeholder="44113">
                <h3><i class="fas fa-phone-alt"></i> Enter your phone number:</h3>
                <input type="tel" id="subscribe-phone" placeholder="1234567890">
                <h3><i class="fas fa-clock"></i> Preferred notification time:</h3>
                <input type="time" id="subscribe-time" value="07:00">
                <label style="font-size: 0.5em;">
                    <input type="checkbox" id="subscribe-consent" required> I agree to receive SMS notifications:
                </label>
                <br>
                <button onclick="subscribeUser()"><i class="fas fa-bell"></i> Subscribe</button>
            </div>

            <!-- Clothing Recommendations -->
            <div class="widget translucent">
                <h3><i class="fas fa-tshirt"></i> Clothing and Accessory Recommendations for Today:</h3>
                <div id="clothing-recommendations">
                    <p>Loading recommendations...</p>
                </div>
            </div>

            <!-- Sunrise and Sunset -->
            <div class="widget translucent">
                <h3><i class="fas fa-sun"></i> Sunrise & Sunset</h3>
                <p id="sunrise"><i class="fas fa-sun"></i> Sunrise: --:--</p>
                <p id="sunset"><i class="fas fa-moon"></i> Sunset: --:--</p>
            </div>

            <!-- Moon Phase -->
            <div class="widget translucent">
                <h3><i class="fas fa-moon"></i> Moon Phase</h3>
                <p id="moon-phase">Moon Phase: --</p>
            </div>
        </section>
    </main>

    <!-- JavaScript Section -->
    <script>
        // Constants
        const API_BASE_URL = window.location.origin;
        let userZip = "44113";

        // Utility Functions
        function formatTimeTo12Hour(timeString) {
            const [hour, minute] = timeString.split(":");
            let hourNum = parseInt(hour);
            const period = hourNum >= 12 ? "PM" : "AM";
            hourNum = hourNum % 12 || 12;
            return `${hourNum}:${minute} ${period}`;
        }

        function formatDate(dateString) {
            const options = { month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function getSelectedUnit() {
            return document.querySelector('input[name="tempUnit"]:checked').value;
        }

        // Fetch and Display Weather
        function fetchWeather() {
            userZip = document.getElementById("zip-code-input").value || "44113";
            showToday();
            loadSunriseSunsetMoonData();
        }

        async function showToday() {
            document.getElementById("today-weather").style.display = "block";
            document.getElementById("forecast-3-days").style.display = "none";

            try {
                const tempUnit = getSelectedUnit();
                const response = await fetch(`${API_BASE_URL}/weather/today-hourly?zip=${userZip}&temp_unit=${tempUnit}`);
                const data = await response.json();
                // Additional code for displaying today's weather
            } catch (error) {
                console.error("Error loading hourly weather:", error);
            }
        }

        async function show3Day() {
            document.getElementById("today-weather").style.display = "none";
            document.getElementById("forecast-3-days").style.display = "block";

            try {
                const tempUnit = getSelectedUnit();
                const response = await fetch(`${API_BASE_URL}/weather/3-day?zip=${userZip}&temp_unit=${tempUnit}`);
                const data = await response.json();
                // Additional code for displaying 3-day weather
            } catch (error) {
                console.error("Error loading 3-day weather:", error);
            }
        }

        async function loadSunriseSunsetMoonData() {
            try {
                const tempUnit = getSelectedUnit();
                const response = await fetch(`${API_BASE_URL}/weather/today-hourly?zip=${userZip}&temp_unit=${tempUnit}`);
                const data = await response.json();
                // Update sunrise, sunset, and moon phase
            } catch (error) {
                console.error("Error loading sunrise, sunset, and moon data:", error);
            }
        }

        // Subscription Handling
        function subscribeUser() {
            const zip = document.getElementById('subscribe-zip').value;
            const phone = document.getElementById('subscribe-phone').value;
            const time = document.getElementById('subscribe-time').value;
            const consent = document.getElementById('subscribe-consent').checked;

            if (zip && phone && time && consent) {
                const notification = document.getElementById('subscribe-notification');
                notification.style.display = 'block';

                setTimeout(() => {
                    notification.style.display = 'none';
                }, 10000);

                fetch(`${API_BASE_URL}/subscribe`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ zip, phone, time }),
                }).catch(error => console.error('Fetch error:', error));
            } else {
                alert('Please fill out all fields and agree to receive SMS notifications before subscribing.');
            }
        }

        // On Page Load
        window.onload = function () {
            showToday();
            loadSunriseSunsetMoonData();
        };
    </script>
</body>
</html>