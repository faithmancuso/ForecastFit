<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForecastFit - Local Weather</title>
    
    <!-- Link to Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Link to your style.css -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="home_page" style="background-image: url('/static/background.jpg'); background-size: cover; background-position: center; background-attachment: fixed; height: 100vh;">
    <header class="translucent">
        <h1>ForecastFit <i class="fas fa-cloud-sun"></i></h1> <!-- Weather Icon added to the header -->
    </header>
    
    <main>
        <section id="weather-section" class="translucent">
            <div id="weather-options">
                <label for="zip-code-input"><i class="fas fa-map-marker-alt"></i> Enter your Zip Code for local weather:</label>
                <input type="text" id="zip-code-input" placeholder="44113" required>
                <button onclick="fetchWeather()"><i class="fas fa-check"></i> Submit</button>

                <div id="forecast-buttons">
                    <button onclick="showToday()"><i class="fas fa-calendar-day"></i> Today (Hourly)</button>
                    <button onclick="show3Day()"><i class="fas fa-calendar-week"></i> 3-Day Forecast</button>
                </div>
            </div>

            <div id="today-weather" class="weather-container" style="display: none;">
                <h2>Today's Weather (Hourly) <i class="fas fa-clock"></i></h2> <!-- Clock Icon added to Today's Weather -->
                <div id="hourly-forecast"></div>
            </div>
            <div id="forecast-3-days" class="weather-container" style="display: none;">
                <h2>3-Day Forecast <i class="fas fa-calendar"></i></h2> <!-- Calendar Icon added to 3-Day Forecast -->
                <div id="daily-forecast"></div>
            </div>
        </section>

        <!-- Right-side widgets container -->
        <section id="right-widgets" class="translucent">
            <!-- Subscribe Form -->
            <div id="form-container" class="translucent">
                <h3><i class="fas fa-map-marker-alt"></i> Enter your Zip Code:</h3>
                <input type="text" placeholder="44113">
                <h3><i class="fas fa-phone-alt"></i> Enter your phone number:</h3>
                <input type="tel" placeholder="1234567890">
                <h3><i class="fas fa-clock"></i> Preferred notification time:</h3>
                <input type="time" value="07:00">
                <button><i class="fas fa-bell"></i> Subscribe</button>
            </div>

            <!-- Placeholder for Clothing and Accessory Recommendations -->
            <div class="widget" class="translucent">
                <h3><i class="fas fa-tshirt"></i> Clothing and Accessory Recommendations for Today:</h3>
                <div id="clothing-recommendations">
                    <p>Loading recommendations...</p>
                </div>
            </div>

            <!-- Sunrise and Sunset Widget -->
            <div class="widget" class="translucent">
                <h3><i class="fas fa-sun"></i> Sunrise & Sunset</h3>
                <p id="sunrise"><i class="fas fa-sun"></i> Sunrise: --:--</p>
                <p id="sunset"><i class="fas fa-moon"></i> Sunset: --:--</p>
            </div>

            <!-- Moon Phase Widget -->
            <div class="widget" class="translucent">
                <h3><i class="fas fa-moon"></i> Moon Phase</h3>
                <p id="moon-phase">Moon Phase: --</p>
            </div>
        </section>
    </main>

    <script>
        let userZip = "44113";

        function fetchWeather() {
            userZip = document.getElementById("zip-code-input").value || "44113";
            showToday();
            loadSunriseSunsetMoonData();
        }

        function formatTimeTo12Hour(timeString) {
            const [hour, minute] = timeString.split(":");
            let hourNum = parseInt(hour);
            const period = hourNum >= 12 ? "PM" : "AM";
            hourNum = hourNum % 12 || 12;
            return `${hourNum}:${minute} ${period}`;
        }

        function formatDate(dateString) {
            const options = { month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function getClothingRecommendations(temperature, condition) {
            let recommendations = [];

            // Temperature-based clothing recommendations
            if (temperature < 50) {
                recommendations.push("Wear a warm jacket or coat.");
            } else if (temperature >= 50 && temperature < 65) {
                recommendations.push("A light jacket or sweater should be enough.");
            } else if (temperature >= 65 && temperature < 75) {
                recommendations.push("It's a mild day, a t-shirt or long-sleeve shirt will be fine.");
            } else {
                recommendations.push("Wear something cool like a short-sleeve shirt or tank top.");
            }

            // Weather condition-based accessories recommendations
            if (condition.toLowerCase().includes("rain")) {
                recommendations.push("Don't forget your umbrella or rain jacket.");
            } else if (condition.toLowerCase().includes("sun")) {
                recommendations.push("Sunglasses and sunscreen are a good idea.");
            } else if (condition.toLowerCase().includes("snow")) {
                recommendations.push("Wear snow boots and a warm scarf.");
            }

            return recommendations;
        }

        async function showToday() {
            document.getElementById("today-weather").style.display = "block";
            document.getElementById("forecast-3-days").style.display = "none";

            try {
                const response = await fetch(`/weather/today-hourly?zip=${userZip}`);
                const data = await response.json();
                const hourlyForecast = data.forecast.forecastday[0]?.hour;
                
                // Get today's temperature and condition for recommendations
                const todayTemperature = hourlyForecast[0]?.temp_f;
                const todayCondition = hourlyForecast[0]?.condition?.text;

                // Get clothing recommendations based on temperature and condition
                const clothingRecommendations = getClothingRecommendations(todayTemperature, todayCondition);

                // Display clothing recommendations
                const clothingContainer = document.getElementById('clothing-recommendations');
                clothingContainer.innerHTML = '';
                
                if (clothingRecommendations.length > 0) {
                    clothingRecommendations.forEach(rec => {
                        const recElement = document.createElement('p');
                        recElement.textContent = rec;
                        clothingContainer.appendChild(recElement);
                    });
                } else {
                    clothingContainer.innerHTML = '<p>Unable to provide clothing recommendations at the moment.</p>';
                }

                const hourlyContainer = document.getElementById('hourly-forecast');
                hourlyContainer.innerHTML = '';

                if (!hourlyForecast) {
                    hourlyContainer.innerHTML = '<p>Error: Unable to load hourly forecast data.</p>';
                    return;
                }

                hourlyForecast.forEach(hour => {
                    const hourBlock = document.createElement('div');
                    hourBlock.className = 'hour-block';
                    hourBlock.innerHTML = `
                        <span><strong>${formatTimeTo12Hour(hour.time.split(" ")[1])}</strong></span>
                        <span>Temp: ${hour.temp_f ? hour.temp_f + '°F' : 'N/A'}</span>
                        <span>Humidity: ${hour.humidity ? hour.humidity + '%' : 'N/A'}</span>
                        <span>Wind: ${hour.wind_mph ? hour.wind_mph + ' mph ' + hour.wind_dir : 'N/A'}</span>
                        <span>${hour.condition?.text || 'N/A'}</span>
                    `;
                    hourlyContainer.appendChild(hourBlock);
                });
            } catch (error) {
                console.error("Error loading hourly weather:", error);
                document.getElementById('hourly-forecast').innerHTML = '<p>Error loading hourly data.</p>';
            }
        }


        async function show3Day() {
            document.getElementById("today-weather").style.display = "none";
            document.getElementById("forecast-3-days").style.display = "block";

            try {
                const response = await fetch(`/weather/3-day?zip=${userZip}`);
                const data = await response.json();
                const dailyForecast = data.forecast.forecastday;

                const dailyContainer = document.getElementById('daily-forecast');
                dailyContainer.innerHTML = '';

                if (!dailyForecast) {
                    dailyContainer.innerHTML = '<p>Error: Unable to load 3-day forecast data.</p>';
                    return;
                }

                dailyForecast.forEach(day => {
                    const dayBlock = document.createElement('div');
                    dayBlock.className = 'day-block';
                    dayBlock.innerHTML = `
                        <p><strong>${formatDate(day.date)}</strong></p>
                        <p>High: ${day.day.maxtemp_f ? day.day.maxtemp_f + '°F' : 'N/A'} / Low: ${day.day.mintemp_f ? day.day.mintemp_f + '°F' : 'N/A'}</p>
                        <p>Humidity: ${day.day.avghumidity ? day.day.avghumidity + '%' : 'N/A'}</p>
                        <p>Wind: ${day.day.maxwind_mph ? day.day.maxwind_mph + ' mph ' + day.day.wind_dir : 'N/A'}</p>
                        <p>${day.day.condition?.text || 'N/A'}</p>
                    `;
                    dailyContainer.appendChild(dayBlock);
                });
            } catch (error) {
                console.error("Error loading 3-day weather:", error);
                document.getElementById('daily-forecast').innerHTML = '<p>Error loading 3-day forecast data.</p>';
            }
        }

        async function loadSunriseSunsetMoonData() {
            try {
                const response = await fetch(`/weather/today-hourly?zip=${userZip}`);
                const data = await response.json();
                const todayForecast = data.forecast.forecastday[0].astro;

                document.getElementById("sunrise").textContent = `Sunrise: ${todayForecast.sunrise}`;
                document.getElementById("sunset").textContent = `Sunset: ${todayForecast.sunset}`;
                document.getElementById("moon-phase").textContent = `Moon Phase: ${todayForecast.moon_phase}`;
            } catch (error) {
                console.error("Error loading sunrise, sunset, and moon data:", error);
                document.getElementById("sunrise").textContent = "Sunrise: N/A";
                document.getElementById("sunset").textContent = "Sunset: N/A";
                document.getElementById("moon-phase").textContent = "Moon Phase: N/A";
            }
        }

        window.onload = function() {
            showToday();
            loadSunriseSunsetMoonData();
        };
    </script>
</body>
</html>
